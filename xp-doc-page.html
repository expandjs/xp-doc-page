<!--
@license
Copyright (c) 2015 The ExpandJS authors. All rights reserved.
This code may only be used under the BSD style license found at https://expandjs.github.io/LICENSE.txt
The complete set of authors may be found at https://expandjs.github.io/AUTHORS.txt
The complete set of contributors may be found at https://expandjs.github.io/CONTRIBUTORS.txt
-->

<!--
This element is used to display a documentation page.

@element xp-doc-page
@description A custom element used to create a documentation page
@keywords documentation, web app, html5, expandjs, web-components
@group contents
@homepage http://expandjs.com/elements/xp-doc-page

@dependency polymer Polymer/polymer#^1.0.0
@dependency expandjs ExpandJS/expandjs#0.9.4
@dependency iron-flex-layout PolymerElements/iron-flex-layout#^1.0.0
@dependency xp-markdown ExpandJS/xp-markdown#0.9.4
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../expandjs/expandjs.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../xp-markdown/xp-markdown.html">

<dom-module id="xp-doc-page">

    <style>
        :host {
            display: block;
            font-size: 16px;
            font-weight: 400;
            letter-spacing: 0.01em;
            line-height: 24px;
            overflow: visible;
            text-overflow: clip;
            text-rendering: optimizeLegibility;
            white-space: normal;
        }

        /* RESET */

        :host a {
            text-decoration: none;
        }

        :host a[href]:hover {
            text-decoration: underline;
        }

        :host h1, :host h2,
        :host ol, :host ul,
        :host /deep/ p {
            margin: 0;
        }

        :host hr {
            background: hsla(0, 0%, 0%, 0.12);
            border: none;
            height: 1px;
            margin: 16px 0 15px 0;
        }

        /* FONT */

        :host .font-caption {
            font-size: 12px;
            font-weight: 400;
            letter-spacing: 0.02em;
            line-height: 14px;
            text-overflow: ellipsis;
            text-rendering: optimizeLegibility;
            white-space: nowrap;
        }

        :host .font-subhead {
            font-size: 16px;
            font-weight: 400;
            letter-spacing: 0.01em;
            line-height: 24px;
            text-overflow: clip;
            text-rendering: optimizeLegibility;
            white-space: normal;
        }

        :host .font-title {
            font-size: 20px;
            font-weight: 500;
            letter-spacing: 0.005em;
            line-height: 24px;
            overflow: hidden;
            text-overflow: ellipsis;
            text-rendering: optimizeLegibility;
            white-space: nowrap;
        }

        :host .font-display2 {
            font-size: 44px;
            font-weight: 400;
            letter-spacing: 0;
            line-height: 48px;
            overflow: hidden;
            text-overflow: ellipsis;
            text-rendering: optimizeLegibility;
            white-space: nowrap;
        }

        /* HEADER */

        :host header .demo {
            float: right;
        }

        :host header .type {
            float: left;
            opacity: 0.30;
            text-transform: capitalize;
        }

        /* SECTION */

        :host section {
            margin-top: 16px;
        }

        :host section .extends,
        :host section .wraps,
        :host section .behaviors {
            margin-top: 16px;
        }

        :host section .extends ~ .wraps,
        :host section .extends ~ .behaviors,
        :host section .wraps ~ .behaviors {
            margin-top: 0;
        }

        :host section .title {
            margin-bottom: 16px;
            text-transform: capitalize;
        }

        :host section .feature {
            @apply(--layout-vertical);
            margin-top: 16px;
        }

        :host section .feature-name,
        :host section .param-name {
            font-weight: 600;
            margin-right: 6px;
            opacity: 0.80;
        }

        :host section .feature-type,
        :host section .param-type,
        :host section .returns-type {
            margin-right: 6px;
            opacity: 0.50;
        }

        :host section .feature-tag {
            @apply(--layout-self-start);
            background: hsla(0, 0%, 13%, 0.80);
            border-radius: 2px;
            box-sizing: border-box;
            color: hsla(0, 0%, 100%, 1);
            margin-right: 6px;
            padding: 4px 8px;
        }

        :host section .feature-default,
        :host section .param-name.optional,
        :host section .subtitle {
            font-style: italic;
        }

        :host section .param-name.optional:after {
            content: ']';
        }

        :host section .param-name.optional:before {
            content: '[';
        }
    </style>

    <template>

        <!-- HEADER -->
        <header class="header">
            <h1 class="font-display2 name">{{data.name}}</h1>
            <h2 class="font-title type">{{data.type}}</h2>
            <template is="dom-if" if="[[data.demo]]" restamp><a class="font-title demo" href$="[[data.demo]]" on-click="_handleClick">Demo</a></template>
            <div style="clear:both"></div>
        </header>

        <!-- DESCRIPTION -->
        <section class="description">
            <h3 class="font-subhead title">Description</h3><hr/>
            <template is="dom-if" if="[[data.summary]]" restamp>
                <xp-markdown class="summary" code="[[data.summary]]"></xp-markdown>
            </template>
            <template is="dom-if" if="[[data.extends]]" restamp>
                <p class="extends">
                    <span class="feature-name">Extends:</span>
                    <template is="dom-if" if="[[data.extends.url]]" restamp><a href$="[[data.extends.url]]" on-click="_handleClick">{{data.extends.name}}</a></template>
                    <template is="dom-if" if="[[!data.extends.url]]" restamp><span>{{data.extends.name}}</span></template>
                </p>
            </template>
            <template is="dom-if" if="[[data.wraps]]" restamp>
                <p class="wraps">
                    <span class="feature-name">Wraps:</span>
                    <template is="dom-if" if="[[data.wraps.url]]" restamp><a href$="[[data.wraps.url]]" on-click="_handleClick">{{data.wraps.name}}</a></template>
                    <template is="dom-if" if="[[!data.wraps.url]]" restamp><span>{{data.wraps.name}}</span></template>
                </p>
            </template>
            <template is="dom-if" if="[[data.behaviors.length]]" restamp>
                <p class="behaviors">
                    <span class="feature-name">Behaviors:</span>
                    <template is="dom-repeat" items="[[data.behaviors]]" as="behavior">
                        <a href$="[[behavior.url]]" on-click="_handleClick">{{behavior.name}}</a>
                        <template is="dom-if" if="[[_hasMore(index, data.behaviors.length)]]" restamp><span>, </span></template>
                    </template>
                </p>
            </template>
        </section>

        <!-- PARAMS -->
        <template is="dom-if" if="[[data.params.length]]" restamp>
            <section class="params">
                <h3 class="font-subhead title">Arguments</h3><hr/>
                <ol class="list params">
                    <template is="dom-repeat" items="[[data.params]]" as="param">
                        <li class="feature-param">
                            <div class="param-info">
                                <span class$="[[_computeParamClass(param)]]">{{_computeParamName(param)}}</span>
                                <span class="param-type">{{param.type}}</span>
                            </div>
                            <div class="param-summary">{{param.summary}}</div>
                            <template is="dom-if" if="[[param.params.length]]" restamp>
                                <ul class="list param-params">
                                    <template is="dom-repeat" items="[[param.params]]" as="subParam">
                                        <div class="param-param">
                                            <div class="param-info">
                                                <span class$="[[_computeSubParamClass(param, subParam)]]">{{_computeSubParamName(param, subParam)}}</span>
                                                <span class="param-type">{{subParam.type}}</span>
                                            </div>
                                            <div class="param-summary">{{subParam.summary}}</div>
                                        </div>
                                    </template>
                                </ul>
                            </template>
                        </li>
                    </template>
                </ol>
            </section>
        </template>

        <!-- RETURNS -->
        <template is="dom-if" if="[[data.returns]]" restamp>
            <section class="returns">
                <h3 class="font-subhead title">Returns</h3><hr/>
                <div class="returns-info">
                    <span class="returns-type">{{data.returns.type}}</span>
                </div>
                <div class="returns-summary">{{data.returns.summary}}</div>
            </section>
        </template>

        <!-- FEATURES -->
        <template is="dom-repeat" items="[[features]]" as="feature">
            <template is="dom-if" if="[[_hasFeature(data, feature)]]" restamp>
                <section class$="[[_computeFeatureClass(feature)]]">
                    <h3 class="font-subhead title">{{_computeFeatureTitle(feature)}}</h3>
                    <template is="dom-repeat" items="[[_computeFeatures(data, feature)]]" as="feat">
                        <hr/><div class="feature">
                            <div class="feature-primary">
                                <span class="feature-name">{{_computeFeatureName(data, feat, feature)}}</span>
                                <template is="dom-if" if="[[feat.type]]" restamp><span class="feature-type">{{feat.type}}</span></template>
                                <template is="dom-if" if="[[feat.abstract]]" restamp><span class="font-caption feature-tag">abstract</span></template>
                                <template is="dom-if" if="[[feat.bubbles]]" restamp><span class="font-caption feature-tag">bubbles</span></template>
                                <template is="dom-if" if="[[feat.cancelable]]" restamp><span class="font-caption feature-tag">cancelable</span></template>
                                <template is="dom-if" if="[[feat.notifies]]" restamp><span class="font-caption feature-tag">notifies</span></template>
                                <template is="dom-if" if="[[feat.readonly]]" restamp><span class="font-caption feature-tag">readonly</span></template>
                                <template is="dom-if" if="[[feat.static]]" restamp><span class="font-caption feature-tag">static</span></template>
                            </div>
                            <div class="feature-secondary">
                                <template is="dom-if" if="[[feat.default]]" restamp>
                                    <div class="feature-default">
                                        <span>Default: </span>
                                        <span>{{feat.default}}</span>
                                    </div>
                                </template>
                                <template is="dom-if" if="[[feat.summary]]" restamp>
                                    <xp-markdown class="featureSummary" code="[[feat.summary]]"></xp-markdown>
                                </template>
                                <template is="dom-if" if="[[feat.params.length]]" restamp>
                                    <div class="subtitle">Arguments</div>
                                    <ol class="list feature-params">
                                        <template is="dom-repeat" items="[[feat.params]]" as="param">
                                            <li class="feature-param">
                                                <div class="param-info">
                                                    <span class$="[[_computeParamClass(param)]]">{{_computeParamName(param)}}</span>
                                                    <span class="param-type">{{param.type}}</span>
                                                </div>
                                                <div class="param-summary">{{param.summary}}</div>
                                                <template is="dom-if" if="[[param.params.length]]" restamp>
                                                    <ul class="list param-params">
                                                        <template is="dom-repeat" items="[[param.params]]" as="subParam">
                                                            <li class="param-param">
                                                                <div class="param-info">
                                                                    <span class$="[[_computeSubParamClass(param, subParam)]]">{{_computeSubParamName(param, subParam)}}</span>
                                                                    <span class="param-type">{{subParam.type}}</span>
                                                                </div>
                                                                <div class="param-summary">{{subParam.summary}}</div>
                                                            </li>
                                                        </template>
                                                    </ul>
                                                </template>
                                            </li>
                                        </template>
                                    </ol>
                                </template>
                                <template is="dom-if" if="[[feat.returns]]" restamp>
                                    <div class="subtitle">Returns</div>
                                    <div class="returns-info">
                                        <span class="returns-type">{{feat.returns.type}}</span>
                                    </div>
                                    <div class="returns-summary">{{feat.returns.summary}}</div>
                                </template>
                            </div>
                        </div>
                    </template>
                </section>
            </template>
        </template>

    </template>

    <script>
        Polymer({

            // ELEMENT
            is: 'xp-doc-page',

            /*********************************************************************/

            /**
             * Fired when a doc link is clicked.
             *
             * @event xp-doc-redirect
             * @param {Element} firer
             * @param {string} href
             * @bubbles
             * @cancelable
             */

            /*********************************************************************/

            // PROPERTIES
            properties: {

                /**
                 * The element's data.
                 *
                 * @attribute data
                 * @type Object
                 * @notifies
                 */
                data: {
                    notify: true,
                    type: Object,
                    value: null
                },

                /**
                 * The list of features.
                 *
                 * @attribute features
                 * @type Array
                 * @default ["constructs", "attributes", "properties", "methods", "events"]
                 * @notifies
                 * @readonly
                 */
                features: {
                    notify: true,
                    readOnly: true,
                    type: Array,
                    value: function () { return ['constructs', 'attributes', 'properties', 'methods', 'events']; }
                }
            },

            /*********************************************************************/

            // COMPUTER
            _computeFeatureClass: function (feature) {
                return 'features' + (feature ? ' ' + feature : '');
            },

            // COMPUTER
            _computeFeatureName: function (data, feat, feature) {
                return feature === 'constructs' ? 'new ' + data.name : feat.name;
            },

            // COMPUTER
            _computeFeatureTitle: function (feature) {
                return feature === 'constructs' ? 'Constructor' : feature || '';
            },

            // COMPUTER
            _computeFeatures: function (data, feature) {
                return (data && (feature === 'constructs' ? [data[feature]] : data[feature])) || [];
            },

            // COMPUTER
            _computeParamClass: function (param) {
                return 'param-name' + (param && (param.optional || param.default) ? ' optional' : '');
            },

            // COMPUTER
            _computeParamName: function (param) {
                return param ? (param.name || '') + (param.default ? ' = ' + param.default : '') : '';
            },

            // COMPUTER
            _computeSubParamClass: function (param, subParam) {
                return 'param-name' + (subParam && (subParam.optional || subParam.default) ? ' optional' : '');
            },

            // COMPUTER
            _computeSubParamName: function (param, subParam) {
                return param && subParam ? (param.name ? param.name + '.' : '') + (subParam.name || '') + (subParam.default ? ' = ' + subParam.default : '') : '';
            },

            // COMPUTER
            _hasFeature: function (data, feature) {
                return !!data && !!data[feature] && (feature === 'constructs' || !!data[feature].length);
            },

            // COMPUTER
            _hasInheritance: function (data) {
                return !!data && (!!data.extends || (!!data.behaviors && !!data.behaviors.length));
            },

            // COMPUTER
            _hasMore: function (index, length) {
                return index < length - 1;
            },

            /*********************************************************************/

            // HANDLER
            _handleClick: function (event) {
                if (!event.button && this.fire('xp-doc-redirect', {firer: this, href: event.target.href}, {cancelable: true}).defaultPrevented) { event.preventDefault(); }
            }
        });
    </script>

</dom-module>